<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>My Music Studio â€“ Cover Video</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{margin:0;background:#111;color:#fff}
header{padding:30px;text-align:center;background:linear-gradient(135deg,#d6004c,#7b1fa2)}
.container{max-width:1000px;margin:auto;padding:40px 20px}
.tabs{display:flex;gap:10px;margin-bottom:30px;flex-wrap:wrap}
.tab{flex:1;padding:15px;background:#1e1e1e;border:none;color:#fff;cursor:pointer;border-radius:12px}
.tab.active{background:linear-gradient(135deg,#d6004c,#7b1fa2)}
.section{display:none}
.section.active{display:block}
.upload-box{background:#1e1e1e;padding:25px;border-radius:12px;margin-bottom:40px}
input{width:100%;padding:12px;margin-bottom:15px;border-radius:8px;border:none}
input[type=file]{background:#fff;color:#000}
button{background:#d6004c;color:#fff;border:none;padding:12px 24px;border-radius:25px;cursor:pointer}
button:disabled{background:#555}
.upload-area{border:3px dashed #d6004c;border-radius:12px;padding:40px;text-align:center;cursor:pointer}
.upload-area.dragover{background:#2a2a2a}
.gallery{margin-top:40px}
.video-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}
.video-card{background:#1e1e1e;border-radius:12px;overflow:hidden;padding:15px}
.video-card video{width:100%;height:200px;object-fit:cover}
.video-info{padding:10px 0}
.video-actions{display:flex;gap:10px}
.download-btn{flex:1;background:#d6004c;color:#fff;text-decoration:none;padding:8px;border-radius:8px;text-align:center}
.delete-btn{flex:1;background:#444;color:#fff;border:none;border-radius:8px}
.audio-player{width:100%;margin-top:10px}
.empty{text-align:center;color:#777;padding:60px}
footer{text-align:center;padding:20px;color:#777}
</style>
</head>

<body>

<header>
<h1>ðŸŽ¶ My Music Studio</h1>
<p>Crea e gestisci video, PDF e MP3 localmente</p>
</header>

<div class="container">

<div class="tabs">
<button class="tab active" onclick="switchTab('create')">ðŸŽ¬ Crea Video</button>
<button class="tab" onclick="switchTab('import')">ðŸ“¤ Importa Video</button>
<button class="tab" onclick="switchTab('pdf')">ðŸ“„ Importa PDF</button>
<button class="tab" onclick="switchTab('audio')">ðŸŽµ MP3</button>
</div>

<!-- SEZIONI ORIGINALI (NON TOCCATE) -->
<div id="createSection" class="section active"></div>
<div id="importSection" class="section"></div>
<div id="pdfSection" class="section"></div>

<!-- ðŸŽµ AUDIO SECTION -->
<div id="audioSection" class="section">
<div class="upload-box">
<input id="audioTitle" placeholder="Titolo MP3">
<input id="audioArtist" placeholder="Artista (opzionale)">
<input type="file" id="audioFile" accept=".mp3,audio/*">
<button onclick="importAudio()">Aggiungi MP3</button>
</div>
</div>

<!-- GALLERIE -->
<div class="gallery" id="audioGallery" style="display:none">
<h2>ðŸŽµ MP3</h2>
<div class="video-grid" id="audioGrid"></div>
</div>

<div class="empty" id="empty">Nessun contenuto</div>

</div>

<footer>Â© 2025 â€“ My Music Studio</footer>

<script>
/* ================== DATABASE ================== */
function openDB(){
return new Promise((res,rej)=>{
const r=indexedDB.open("VideoDB",3)
r.onupgradeneeded=e=>{
const db=e.target.result
if(!db.objectStoreNames.contains("videos")) db.createObjectStore("videos",{keyPath:"id"})
if(!db.objectStoreNames.contains("pdfs")) db.createObjectStore("pdfs",{keyPath:"id"})
if(!db.objectStoreNames.contains("audios")) db.createObjectStore("audios",{keyPath:"id"})
}
r.onsuccess=e=>res(e.target.result)
})
}

/* ================== AUDIO FUNCTIONS (NUOVE) ================== */
async function saveAudio(blob,title,artist){
const db=await openDB()
const tx=db.transaction("audios","readwrite")
tx.objectStore("audios").put({
id:Date.now().toString(),
blob,
title,
artist,
date:Date.now()
})
return new Promise(r=>tx.oncomplete=r)
}

async function getAudios(){
const db=await openDB()
const tx=db.transaction("audios","readonly")
return new Promise(r=>tx.objectStore("audios").getAll().onsuccess=e=>r(e.target.result))
}

async function deleteAudio(id){
if(!confirm("Eliminare MP3?")) return
const db=await openDB()
const tx=db.transaction("audios","readwrite")
tx.objectStore("audios").delete(id)
tx.oncomplete=loadGallery
}

async function importAudio(){
const file=document.getElementById('audioFile').files[0]
if(!file){alert("Seleziona un MP3");return}
const title=document.getElementById('audioTitle').value||file.name
const artist=document.getElementById('audioArtist').value||""
await saveAudio(file,title,artist)
document.getElementById('audioFile').value=""
document.getElementById('audioTitle').value=""
document.getElementById('audioArtist').value=""
loadGallery()
}

/* ================== LOAD GALLERY (ESTESA) ================== */
async function loadGallery(){
const audios=await getAudios()
const audioGrid=document.getElementById('audioGrid')
const audioGallery=document.getElementById('audioGallery')
const empty=document.getElementById('empty')

audioGrid.innerHTML=""

if(audios.length===0){
audioGallery.style.display="none"
empty.style.display="block"
return
}

empty.style.display="none"
audioGallery.style.display="block"

audios.sort((a,b)=>b.date-a.date).forEach(a=>{
const url=URL.createObjectURL(a.blob)
audioGrid.innerHTML+=`
<div class="video-card">
<div class="video-info"><b>${a.title}</b><br>${a.artist}</div>
<audio class="audio-player" controls src="${url}"></audio>
<div class="video-actions">
<a class="download-btn" href="${url}" download="${a.title}.mp3">Scarica</a>
<button class="delete-btn" onclick="deleteAudio('${a.id}')">Elimina</button>
</div>
</div>`
})
}

window.onload=loadGallery
</script>

</body>
</html>

