<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>My Music Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{margin:0;background:#111;color:#fff}
header{padding:30px;text-align:center;background:linear-gradient(135deg,#d6004c,#7b1fa2)}
.container{max-width:1000px;margin:auto;padding:40px 20px}
.tabs{display:flex;gap:10px;margin-bottom:30px;flex-wrap:wrap}
.tab{flex:1;padding:15px;background:#1e1e1e;border:none;color:#fff;cursor:pointer;border-radius:12px}
.tab.active{background:linear-gradient(135deg,#d6004c,#7b1fa2)}
.section{display:none}
.section.active{display:block}
.upload-box{background:#1e1e1e;padding:25px;border-radius:12px;margin-bottom:40px}
input{width:100%;padding:12px;margin-bottom:15px;border-radius:8px;border:none}
input[type=file]{background:#fff;color:#000}
button{background:#d6004c;color:#fff;border:none;padding:12px 24px;border-radius:25px;cursor:pointer}
button:disabled{background:#555}
.upload-area{border:3px dashed #d6004c;border-radius:12px;padding:40px;text-align:center;cursor:pointer}
.upload-area.dragover{background:#2a2a2a}
.gallery{margin-top:40px}
.video-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}
.video-card{background:#1e1e1e;border-radius:12px;overflow:hidden}
.video-card video,
.video-card audio{width:100%}
.video-info{padding:15px}
.video-actions{display:flex;gap:10px;padding:0 15px 15px}
.download-btn{flex:1;background:#d6004c;color:#fff;text-decoration:none;padding:8px;border-radius:8px;text-align:center}
.delete-btn{flex:1;background:#444;color:#fff;border:none;border-radius:8px}
.view-btn{flex:1;background:#7b1fa2;color:#fff;border:none;border-radius:8px}
.empty{text-align:center;color:#777;padding:60px}
.pdf-card{padding:20px}
.pdf-icon{font-size:80px;text-align:center;margin-bottom:15px}
footer{text-align:center;padding:20px;color:#777}
</style>
</head>

<body>

<header>
<h1>ğŸ¶ My Music Studio</h1>
<p>Video, PDF e MP3 salvati localmente</p>
</header>

<div class="container">

<div class="tabs">
<button class="tab active" onclick="switchTab('create')">ğŸ¬ Crea Video</button>
<button class="tab" onclick="switchTab('import')">ğŸ“¤ Importa Video</button>
<button class="tab" onclick="switchTab('pdf')">ğŸ“„ Importa PDF</button>
<button class="tab" onclick="switchTab('mp3')">ğŸµ Importa MP3</button>
</div>

<!-- CREA VIDEO (INVARIATO) -->
<div id="createSection" class="section active">
<div class="upload-box">
<input id="title" placeholder="Titolo">
<input id="artist" placeholder="Artista">
<input type="file" id="coverFile" accept="image/*">
<input type="file" id="audioFile" accept="audio/*">
<button onclick="alert('Sezione creazione video invariata')">Crea Video</button>
</div>
</div>

<!-- IMPORT VIDEO -->
<div id="importSection" class="section">
<div class="upload-box">
<input id="importTitle" placeholder="Titolo">
<input id="importArtist" placeholder="Artista">
<div class="upload-area" id="uploadArea">ğŸ¬ Clicca o trascina video</div>
<input type="file" id="importFile" accept="video/*" hidden>
<button id="importBtn" disabled onclick="importVideo()">Aggiungi Video</button>
</div>
</div>

<!-- IMPORT PDF -->
<div id="pdfSection" class="section">
<div class="upload-box">
<input id="pdfTitle" placeholder="Titolo PDF">
<input id="pdfDescription" placeholder="Descrizione">
<div class="upload-area" id="pdfUploadArea">ğŸ“„ Clicca o trascina PDF</div>
<input type="file" id="pdfFile" accept="application/pdf" hidden>
<button id="pdfBtn" disabled onclick="importPDF()">Aggiungi PDF</button>
</div>
</div>

<!-- IMPORT MP3 -->
<div id="mp3Section" class="section">
<div class="upload-box">
<input id="mp3Title" placeholder="Titolo MP3">
<input id="mp3Artist" placeholder="Artista">
<div class="upload-area" id="mp3UploadArea">ğŸµ Clicca o trascina MP3</div>
<input type="file" id="mp3File" accept="audio/*" hidden>
<button id="mp3Btn" disabled onclick="importMP3()">Aggiungi MP3</button>
</div>
</div>

<!-- GALLERIE -->
<div class="gallery" id="gallery"><h2>ğŸï¸ Video</h2><div id="videoGrid" class="video-grid"></div></div>
<div class="gallery" id="pdfGallery"><h2>ğŸ“„ PDF</h2><div id="pdfGrid" class="video-grid"></div></div>
<div class="gallery" id="mp3Gallery"><h2>ğŸµ MP3</h2><div id="mp3Grid" class="video-grid"></div></div>

<div class="empty" id="empty">Nessun contenuto</div>

</div>

<footer>Â© 2025 â€“ My Music Studio</footer>

<script>
/* ---------------- TABS ---------------- */
function switchTab(t){
document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'))
document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'))
document.getElementById(t+'Section').classList.add('active')
}

/* ---------------- DB (FIX DEFINITIVO) ---------------- */
function openDB(){
return new Promise((res,rej)=>{
const r=indexedDB.open("VideoDB",2)
r.onupgradeneeded=e=>{
const db=e.target.result
if(!db.objectStoreNames.contains("videos"))db.createObjectStore("videos",{keyPath:"id"})
if(!db.objectStoreNames.contains("pdfs"))db.createObjectStore("pdfs",{keyPath:"id"})
if(!db.objectStoreNames.contains("mp3s"))db.createObjectStore("mp3s",{keyPath:"id"})
}
r.onsuccess=e=>res(e.target.result)
r.onerror=e=>rej(e.target.error)
})
}

/* ---------------- GETTERS ---------------- */
async function getAll(store){
const db=await openDB()
return new Promise(res=>{
const tx=db.transaction(store,"readonly")
tx.objectStore(store).getAll().onsuccess=e=>res(e.target.result)
})
}

/* ---------------- IMPORT VIDEO ---------------- */
let selectedVideo=null
uploadArea.onclick=()=>importFile.click()
importFile.onchange=e=>{selectedVideo=e.target.files[0];importBtn.disabled=false}
async function importVideo(){
const blob=new Blob([await selectedVideo.arrayBuffer()],{type:selectedVideo.type})
const db=await openDB()
db.transaction("videos","readwrite")
.objectStore("videos")
.put({id:Date.now().toString(),blob,title:importTitle.value,artist:importArtist.value,date:Date.now()})
loadGallery()
}

/* ---------------- IMPORT PDF ---------------- */
let selectedPDF=null
pdfUploadArea.onclick=()=>pdfFile.click()
pdfFile.onchange=e=>{selectedPDF=e.target.files[0];pdfBtn.disabled=false}
async function importPDF(){
const blob=new Blob([await selectedPDF.arrayBuffer()],{type:"application/pdf"})
const db=await openDB()
db.transaction("pdfs","readwrite")
.objectStore("pdfs")
.put({id:Date.now().toString(),blob,title:pdfTitle.value,description:pdfDescription.value,date:Date.now()})
loadGallery()
}

/* ---------------- IMPORT MP3 ---------------- */
let selectedMP3=null
mp3UploadArea.onclick=()=>mp3File.click()
mp3File.onchange=e=>{selectedMP3=e.target.files[0];mp3Btn.disabled=false}
async function importMP3(){
const blob=new Blob([await selectedMP3.arrayBuffer()],{type:selectedMP3.type})
const db=await openDB()
db.transaction("mp3s","readwrite")
.objectStore("mp3s")
.put({id:Date.now().toString(),blob,title:mp3Title.value,artist:mp3Artist.value,date:Date.now()})
loadGallery()
}

/* ---------------- LOAD GALLERY (FIX) ---------------- */
async function loadGallery(){
const vids=await getAll("videos")
const pdfs=await getAll("pdfs")
const mp3s=await getAll("mp3s")

videoGrid.innerHTML=pdfGrid.innerHTML=mp3Grid.innerHTML=""
gallery.style.display=vids.length?"block":"none"
pdfGallery.style.display=pdfs.length?"block":"none"
mp3Gallery.style.display=mp3s.length?"block":"none"
empty.style.display=vids.length||pdfs.length||mp3s.length?"none":"block"

vids.forEach(v=>{
const url=URL.createObjectURL(v.blob)
videoGrid.innerHTML+=`<div class="video-card"><video controls src="${url}"></video><div class="video-info"><b>${v.title}</b><br>${v.artist}</div></div>`
})

pdfs.forEach(p=>{
const url=URL.createObjectURL(p.blob)
pdfGrid.innerHTML+=`<div class="video-card pdf-card"><div class="pdf-icon">ğŸ“„</div><div class="video-info"><b>${p.title}</b></div><a class="download-btn" href="${url}" download>Scarica</a></div>`
})

mp3s.forEach(m=>{
const url=URL.createObjectURL(m.blob)
mp3Grid.innerHTML+=`<div class="video-card"><audio controls src="${url}"></audio><div class="video-info"><b>${m.title}</b><br>${m.artist}</div></div>`
})
}

window.onload=loadGallery
</script>

</body>
</html>


